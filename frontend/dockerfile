FROM node:16

WORKDIR /app

COPY package*.json /app/

RUN npm install --global pm2
RUN npm install --production
RUN npm install

COPY ./ /app/

RUN npm run build

EXPOSE 3000

FROM nginx:stable-alpine as production-stage
COPY  ./nginx/nginx.conf /etc/nginx/conf.d/default.conf

CMD [ "pm2-runtime", "npm", "start", "daemon off;", "nginx", "-g"]
